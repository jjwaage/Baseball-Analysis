---
title: "Comparing My Playoff Projection to Playoff Percentages Each Week"
author: "Jonna Waage"
date: "2023-09-25"
---

## How does my Projection of Playoff Contending Teams Compare to their Percentages of Making the Playoffs Every Week?

```{r setup, include=FALSE}
##install.packages("gganimate")
library(gifski)
library(gganimate)
#library(animation)
library(quarto)
library(tidyverse)
library(dplyr)
library(readxl)
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(ggplot2)
library(MASS)
library(scales)
library(reshape2)
library(data.table)
```

```{r, echo=TRUE}
load("playoffsummarydata.RData")

files <- list.files( pattern = "*.xlsx", full.names = TRUE)

all_data <- files %>%
  map_dfr(~ {
    temp_data <- read_excel(.x, skip = 1)
    temp_data <- temp_data[, c("Date", "Post")] %>%
      mutate(FileName = tools::file_path_sans_ext(basename(.x)))
    return(temp_data)
  })

print(playoffsummary)

convert_to_percentage <- function(value) {
  # Remove greater than and less than signs if present
  cleaned_value <- gsub("[><]", "", as.character(value))
  
  if (grepl("%", cleaned_value)) {
    return(cleaned_value)
  } else if (grepl("E", cleaned_value)) {
    return(sprintf("%.2f%%", as.numeric(cleaned_value) * 100))
  } else {
    return(sprintf("%.2f%%", as.numeric(cleaned_value) * 100))
  }
}

all_data$Post <- sapply(all_data$Post, convert_to_percentage)

names(all_data)[names(all_data) == "FileName"] <- "Team"
print(all_data)

#write.csv(playoffsummary, file = "playoffsummary.csv")
playoffsummary<-read.csv("playoffsummary.csv")

merged_data <- merge(playoffsummary, all_data, by.x = "Team_short", by.y = "Team")

# Assuming 'merged_data' is your merged data frame
# Convert the "Date" column to a proper date format
merged_data$Date <- as.Date(merged_data$Date, format = "%Y-%m-%d")

# Make sure 'Team' is a factor
merged_data$Team <- factor(merged_data$Team, levels = unique(merged_data$Team))

merged_data$Post <- as.numeric(gsub("%", "", merged_data$Post))

# Create the animated dot plot using gganimate
p <- ggplot(merged_data, aes(x = Percent.Playoffs.Made, y = Post, color = Team, label = as.character(Date))) +
  geom_point(size = 1) +  # Adjust the size of the points
  geom_text(hjust = 0, vjust = 1, size = 3, x = 0, y = 1) +
  labs(title = "MLB Playoff Percentage Comparison") +
  theme_minimal() +
  transition_time(Date) +  # Use transition_time for animation over time
  enter_fade() +
  exit_fade() +
  theme(axis.text = element_text(size = 6),  # Adjust text size on the axes
        plot.title = element_text(hjust = 0.5),  # Center the title
        axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
        axis.text.y = element_text(size = 6),  # Adjust y-axis text size
        axis.ticks = element_blank(),  # Remove axis ticks
        plot.margin = margin(2, 10, 2, 2, "mm")) +  # Adjust plot margin

  scale_x_discrete() +  # Use scale_x_discrete for discrete x-axis values
  scale_y_continuous(breaks = seq(0, 100, by = 10))
  annotate("text", x = Inf, y = Inf, label = paste("Date: ", as.character(merged_data$Date[1])), hjust = 1, vjust = 1, size = 3, color = "black")



# Save the animation as a GIF directly to the desired location
final_animation_file <- "/Users/jonnawaage/Documents/GitHub/Baseball Analysis/docs/posts/Playoff Analysis/mlb_playoff_animation.gif"
gganimate::anim_save(final_animation_file, animate(p, nframes = 100, duration = 100, end_pause = 10), renderer = gifski_renderer)

# Display the animation in the R Markdown document
knitr::include_graphics(final_animation_file)

```
