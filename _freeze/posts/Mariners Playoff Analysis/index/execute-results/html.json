{
  "hash": "35224444dde48cb6243fa93af2f41e91",
  "result": {
    "markdown": "---\ntitle: \"Mariners Playoff Analysis\"\nauthor: \"Jonna Waage\"\ndate: \"2023-05-31\"\n---\n\n\n**If the rest of the MLB games this season were decided by a coin flip, would the Mariners make the playoffs?**\n\n\n\n\n\n#### Introduction\n\nSimulates a 2023 season of all 161 games using the Bradley-Terry model.\n\nBy repeated simulations, can explore the relationship between talent and season performance.\n\nTalent has been edited so that each team has the same talent. Essentially a 50/50 chance for each game.\n\n#### Main functions\n\nRead in two functions:\n\n-   `one.simulation.20()` performs the simulation\n-   `print_standings()` prints the division standings of the simulation\n\nReads in the data:\n\n-   `schedule1 <- read_excel(\"schedule.xlsx\")` reads in a two column excel sheet with headers 'Home' and 'Away' and teams from each game listed below\n\n\n::: {.cell}\n\n:::\n\n\nRead in several packages that I'll need.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(MASS)\n```\n:::\n\n\nAlso I am adding several helper functions `increasefont()` and `centertitle()` that I will use in ggplot2.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincreasefont <- function(Size = 18){\n  theme(text = element_text(size = Size))\n}\n\ndecreasefont <- function(Size = 14){\n  theme(text = element_text(size = Size))\n}\n\ncentertitle <- function(Color = \"blue\"){\n    theme(plot.title = \n            element_text(colour = Color, size = 18, \n        hjust = 0.5, vjust = 0.8, angle = 0))\n}\n```\n:::\n\n\n#### One simulation\n\nOne simulation assuming a standard deviation of 0.3.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# set.seed(121)\nout <- one.simulation.20(0.01)\nprint_standings(out)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                                                        \n                 AL East    W     L                   NL East    W     L\n                 ------------------                   ------------------\n           Tampa Bay Rays   88   73       Washington Nationals   85   76\n        Baltimore Orioles   85   76              Miami Marlins   80   81\n        Toronto Blue Jays   84   77              New York Mets   79   82\n         New York Yankees   77   84             Atlanta Braves   73   88\n           Boston Red Sox   71   90      Philadelphia Phillies   65   96\n                                                                        \n                 AL Cent    W     L                   NL Cent    W     L\n                 ------------------                   ------------------\n           Detroit Tigers   87   74         Pittsburgh Pirates   87   74\n       Kansas City Royals   86   75            Cincinnati Reds   85   76\n          Minnesota Twins   84   77        St. Louis Cardinals   82   79\n        Chicago White Sox   83   78          Milwaukee Brewers   74   87\n      Cleveland Guardians   79   82               Chicago Cubs   72   89\n                                                                        \n                 AL West    W     L                    NL West   W     L\n                 ------------------                   ------------------\n         Seattle Mariners   90   71           Colorado Rockies   97   64\n            Texas Rangers   87   74       Arizona Diamondbacks   93   68\n       Los Angeles Angels   79   82        Los Angeles Dodgers   81   80\n           Houston Astros   77   84           San Diego Padres   77   84\n        Oakland Athletics   74   87       San Francisco Giants   69   92\n```\n:::\n:::\n\n\n#### 1000 Simulations\n\nStore the results of 1000 simulated seasons:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_out <- NULL  \nfor(j in 1:1000){\n  out <- one.simulation.20(0.01)\n  out$Simulation <- j\n  all_out <- rbind(all_out, out)\n}\n```\n:::\n\n\n#### Talent and probability of making playoffs\n\n\n::: {.cell}\n\n:::\n\n\nDefine a new variable Level that is 0 (missed playoffs), 1 (wild-card), or 2 (win division).\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\nPrinting percentage of playoffs made from each team over 1000 seasons.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n                                                                              \n               AL East  Count  Percent                 NL East  Count  Percent\n                  --------------------                    --------------------\n         Boston Red Sox  419     41.9%           Atlanta Braves  412     41.2%\n       New York Yankees  408     40.8%            New York Mets  401     40.1%\n         Tampa Bay Rays  404     40.4%            Miami Marlins  392     39.2%\n      Baltimore Orioles  393     39.3%    Philadelphia Phillies  388     38.8%\n      Toronto Blue Jays  387     38.7%     Washington Nationals  388     38.8%\n                                                                              \n               AL Cent  Count  Percent                 NL Cent  Count  Percent\n                  --------------------                    --------------------\n      Chicago White Sox  421     42.1%          Cincinnati Reds  416     41.6%\n     Kansas City Royals  395     39.5%        Milwaukee Brewers  408     40.8%\n    Cleveland Guardians  389     38.9%             Chicago Cubs  396     39.6%\n        Minnesota Twins  383     38.3%       Pittsburgh Pirates  396     39.6%\n         Detroit Tigers  381     38.1%      St. Louis Cardinals  394     39.4%\n                                                                              \n               AL West  Count  Percent                 NL West  Count  Percent\n                  --------------------                    --------------------\n          Texas Rangers  417     41.7%      Los Angeles Dodgers  421     42.1%\n       Seattle Mariners  414     41.4%         San Diego Padres  409     40.9%\n         Houston Astros  405     40.5%     Arizona Diamondbacks  399     39.9%\n      Oakland Athletics  393     39.3%         Colorado Rockies  395     39.5%\n     Los Angeles Angels  391     39.1%     San Francisco Giants  385     38.5%\n```\n:::\n:::\n\n\nLevel is an ordinal response variable. Using a proportional odds model, model the ordinal response as a function of the team's talent.\n\nFor a range of talent values from -0.9 to 0.9, find the fitted model probability of the three outcomes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npfit <- polr(Level ~ Talent,\n             data = all_out)\nDF <- data.frame(Talent = seq(-0.9, 0.9,\n                                  length.out = 200))\nProb <- predict(pfit, DF, type = \"probs\")\nDF1 <- DF2 <- DF3 <- DF\nDF1$Probability <- Prob[, 3]; DF1$Type <- \"Division\"\nDF2$Probability <- Prob[, 2]; DF2$Type <- \"Wild Card\"\nDF3$Probability <- Prob[, 3] + Prob[, 2]\nDF3$Type <- \"Playoff\"\nDFall <- rbind(DF1, DF2, DF3)\n```\n:::\n\n\nGraph of this division, wild card, and playoff probabilities.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(DFall, aes(Talent, Probability,\n                  color = Type)) +\n  geom_line() +\n  increasefont() +\n  ggtitle(\"Probability of Reaching Different Levels\") +\n  centertitle()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n#### Talents of wild card teams and division-winners\n\nConstruct density estimates of\n\n-   all teams\n-   teams that win division\n-   teams that get wild card\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata1 <- filter(all_out, Wild.Card == 1) %>% \n         mutate(Type = \"Wild Card\")\ndata2 <- filter(all_out, Winner.Div == 1) %>% \n  mutate(Type = \"Win Division\")\ndata3 <- all_out %>% \n  mutate(Type = \"All Teams\")\n\nggplot(rbind(data1, data2, data3), \n       aes(Talent, color = Type)) +\n  geom_density(size = 1.5) +\n  increasefont() + centertitle() +\n  ggtitle(\"Talent Distributions for Three Types of Teams\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n#### How many games to win?\n\nFind the conditional probability of winning division title, of getting wild card, and making the playoffs given you won X games.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_out %>% \n  filter(Wins >= 25, Wins <= 45) %>% \n  group_by(Wins) %>% \n  summarize(N = n(), \n            Prob_Div = mean(Winner.Div),\n            Prob_WC = mean(Wild.Card),\n            .groups = \"drop\") -> S\n```\n:::\n\n\nPlot smooths of these empirical probabilities.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nS %>% \n  ggplot() +\n  geom_smooth(aes(Wins, Prob_Div), se = FALSE,\n              color = \"red\",\n              method = \"loess\") +\n  geom_smooth(aes(Wins, Prob_WC), se = FALSE,\n              color = \"blue\",\n              method = \"loess\") + \n  geom_smooth(aes(Wins, Prob_Div + Prob_WC),\n                  se = FALSE,\n              color = \"black\",\n              method = \"loess\") +\n  increasefont() +\n  ylab(\"Probability\") +\n  annotate(geom = \"text\", x = 32, y = 0.75,\n           label = \"Playoffs\", size = 7) +\n  annotate(geom = \"text\", x = 40.3, y = 0.75,\n           label = \"Division\", size = 7,\n           color = \"red\") +\n  annotate(geom = \"text\", x = 40.8, y = 0.25,\n           label = \"Wild Card\", size = 7,\n           color = \"blue\") +\n  ggtitle(\"How Many Games Does Team Need to Win?\") +\n  centertitle()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\\`\\`\\`\\`\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}