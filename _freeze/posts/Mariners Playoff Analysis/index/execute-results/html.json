{
  "hash": "0fd01ac73b555d608f740d0dffc9a2e1",
  "result": {
    "markdown": "---\ntitle: \"Mariners Playoff Analysis\"\nauthor: \"Jonna Waage\"\ndate: \"2023-05-31\"\n---\n\n\n**If the rest of the MLB games this season were decided by a coin flip, would the Mariners make the playoffs?**\n\n\n\n\n\n#### Introduction\n\nSimulates a 2023 season of all 161 games using the Bradley-Terry model.\n\nBy repeated simulations, can explore the relationship between talent and season performance.\n\nTalent has been edited so that it is decided by z-scores of average runs score - average runs allowed by each team and then divided by 10. \n\n#### Main functions\n\nRead in two functions:\n\n-   `one.simulation()` performs the simulation\n-   `print_standings()` prints the division standings of the simulation\n\nReads in the data:\n\n-   `schedule1 <- read_excel(\"schedule.xlsx\")` reads in a two column excel sheet with headers 'Home' and 'Away' and teams from each game listed below\n-   `battingstats <- read_excel(\"2022battingstats.xlsx\")` reads in a excel sheet with 2022 MLB batting statistics for all teams\n-   `fieldingstats <- read_excel(\"fieldingstats2022.xlsx\")`reads in a excel sheet with 2022 MLB fielding statistics for all teams\n\n\n\n::: {.cell}\n\n:::\n\n\n\nAlso I am adding several helper functions `increasefont()` and `centertitle()` that I will use in ggplot2.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincreasefont <- function(Size = 18){\n  theme(text = element_text(size = Size))\n}\n\ncentertitle <- function(Color = \"blue\"){\n    theme(plot.title = \n            element_text(colour = Color, size = 18, \n        hjust = 0.5, vjust = 0.8, angle = 0))\n}\n```\n:::\n\n\n#### One simulation\n\nOne season simulation with Wins and Losses from each team\n\n\n::: {.cell}\n::: {.cell-output-display}\n|        NL East        | Wins|Losses |       NL Cent       | Wins|Losses |       NL West        | Wins|Losses |\n|:---------------------:|----:|:------|:-------------------:|----:|:------|:--------------------:|----:|:------|\n|    Atlanta Braves     |   99|62     |   Cincinnati Reds   |   91|70     | Los Angeles Dodgers  |   97|64     |\n| Philadelphia Phillies |   85|76     |  Milwaukee Brewers  |   86|75     |   San Diego Padres   |   86|75     |\n|     Miami Marlins     |   81|80     | St. Louis Cardinals |   81|80     |   Colorado Rockies   |   85|76     |\n|     New York Mets     |   74|87     |    Chicago Cubs     |   74|87     | Arizona Diamondbacks |   81|80     |\n| Washington Nationals  |   72|89     | Pittsburgh Pirates  |   67|94     | San Francisco Giants |   79|82     |\n:::\n\n::: {.cell-output-display}\n|      AL East      | Wins|Losses |       AL Cent       | Wins|Losses |      AL West       | Wins|Losses |\n|:-----------------:|----:|:------|:-------------------:|----:|:------|:------------------:|----:|:------|\n|  Tampa Bay Rays   |   93|68     |  Chicago White Sox  |   89|72     |  Seattle Mariners  |   92|69     |\n| Baltimore Orioles |   88|73     |   Minnesota Twins   |   82|79     |   Houston Astros   |   82|79     |\n| Toronto Blue Jays |   86|75     | Cleveland Guardians |   76|85     |   Texas Rangers    |   68|93     |\n| New York Yankees  |   85|76     |   Detroit Tigers    |   72|89     | Oakland Athletics  |   66|95     |\n|  Boston Red Sox   |   78|83     | Kansas City Royals  |   69|92     | Los Angeles Angels |   66|95     |\n:::\n:::\n\n\n#### 1000 Simulations\n\nStore the results of 1000 simulated seasons:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_out <- NULL  \nfor(j in 1:100){\n  out <- one.simulation()\n  out$Simulation <- j\n  all_out <- rbind(all_out, out)\n}\n```\n:::\n\n\n#### Talent and probability of making playoffs\n\nDefine a new variable Level that is 0 (missed playoffs), 1 (wild-card), or 2 (win division).\n\n\n::: {.cell}\n\n:::\n\n\nPrinting percentage of playoffs made from each team over 1000 seasons.\n\n\n::: {.cell}\n::: {.cell-output-display}\n|Team                  | Percent Playoffs Made|\n|:---------------------|---------------------:|\n|Arizona Diamondbacks  |                  0.29|\n|Atlanta Braves        |                  0.70|\n|Baltimore Orioles     |                  0.30|\n|Boston Red Sox        |                  0.27|\n|Chicago Cubs          |                  0.35|\n|Chicago White Sox     |                  0.32|\n|Cincinnati Reds       |                  0.10|\n|Cleveland Guardians   |                  0.52|\n|Colorado Rockies      |                  0.13|\n|Detroit Tigers        |                  0.17|\n|Houston Astros        |                  0.76|\n|Kansas City Royals    |                  0.16|\n|Los Angeles Angels    |                  0.33|\n|Los Angeles Dodgers   |                  0.86|\n|Miami Marlins         |                  0.20|\n|Milwaukee Brewers     |                  0.48|\n|Minnesota Twins       |                  0.45|\n|New York Mets         |                  0.59|\n|New York Yankees      |                  0.78|\n|Oakland Athletics     |                  0.08|\n|Philadelphia Phillies |                  0.50|\n|Pittsburgh Pirates    |                  0.11|\n|San Diego Padres      |                  0.45|\n|San Francisco Giants  |                  0.52|\n|Seattle Mariners      |                  0.45|\n|St. Louis Cardinals   |                  0.66|\n|Tampa Bay Rays        |                  0.53|\n|Texas Rangers         |                  0.32|\n|Toronto Blue Jays     |                  0.56|\n|Washington Nationals  |                  0.06|\n:::\n:::\n\n\nLevel is an ordinal response variable. Using a proportional odds model, model the ordinal response as a function of the team's talent.\n\nFor a range of talent values from -0.9 to 0.9, find the fitted model probability of the three outcomes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npfit <- polr(Level ~ Talent,\n             data = all_out)\nDF <- data.frame(Talent = seq(-0.9, 0.9,\n                                  length.out = 200))\nProb <- predict(pfit, DF, type = \"probs\")\nDF1 <- DF2 <- DF3 <- DF\nDF1$Probability <- Prob[, 3]; DF1$Type <- \"Division\"\nDF2$Probability <- Prob[, 2]; DF2$Type <- \"Wild Card\"\nDF3$Probability <- Prob[, 3] + Prob[, 2]\nDF3$Type <- \"Playoff\"\nDFall <- rbind(DF1, DF2, DF3)\n```\n:::\n\n\nGraph of this division, wild card, and playoff probabilities.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(DFall, aes(Talent, Probability,\n                  color = Type)) +\n  geom_line() +\n  increasefont() +\n  ggtitle(\"Probability of Reaching Different Levels\") +\n  centertitle()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n#### Talents of wild card teams and division-winners\n\nConstruct density estimates of\n\n-   all teams\n-   teams that win division\n-   teams that get wild card\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata1 <- filter(all_out, Wild.Card == 1) %>% \n         mutate(Type = \"Wild Card\")\ndata2 <- filter(all_out, Winner.Div == 1) %>% \n  mutate(Type = \"Win Division\")\ndata3 <- all_out %>% \n  mutate(Type = \"All Teams\")\n\nggplot(rbind(data1, data2, data3), \n       aes(Talent, color = Type)) +\n  geom_density(size = 1.5) +\n  increasefont() + centertitle() +\n  ggtitle(\"Talent Distributions for Three Types of Teams\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n#### How many games to win?\n\nFind the conditional probability of winning division title, of getting wild card, and making the playoffs given you won X games.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_out %>% \n  filter(Wins >= 25, Wins <= 45) %>% \n  group_by(Wins) %>% \n  summarize(N = n(), \n            Prob_Div = mean(Winner.Div),\n            Prob_WC = mean(Wild.Card),\n            .groups = \"drop\") -> S\n```\n:::\n\n\nPlot smooths of these empirical probabilities.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nS %>% \n  ggplot() +\n  geom_smooth(aes(Wins, Prob_Div), se = FALSE,\n              color = \"red\",\n              method = \"loess\") +\n  geom_smooth(aes(Wins, Prob_WC), se = FALSE,\n              color = \"blue\",\n              method = \"loess\") + \n  geom_smooth(aes(Wins, Prob_Div + Prob_WC),\n                  se = FALSE,\n              color = \"black\",\n              method = \"loess\") +\n  increasefont() +\n  ylab(\"Probability\") +\n  annotate(geom = \"text\", x = 32, y = 0.75,\n           label = \"Playoffs\", size = 7) +\n  annotate(geom = \"text\", x = 40.3, y = 0.75,\n           label = \"Division\", size = 7,\n           color = \"red\") +\n  annotate(geom = \"text\", x = 40.8, y = 0.25,\n           label = \"Wild Card\", size = 7,\n           color = \"blue\") +\n  ggtitle(\"How Many Games Does Team Need to Win?\") +\n  centertitle()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\\`\\`\\`\\`\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}