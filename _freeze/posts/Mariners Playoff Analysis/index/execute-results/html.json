{
  "hash": "7787e097a8a2545419e621fc3ad945b0",
  "result": {
    "markdown": "---\ntitle: \"Estimating Playoffs Based on the Previous Year's Data\"\nauthor: \"Jonna Waage\"\ndate: \"2023-05-31\"\n---\n\n\n**Can the next MLB season be estimated by the last year's run differential data?**\n\n\n\n\n\n#### Introduction\n\nSimulates a 2023 season of all 162 games using the Bradley-Terry model.\n\nUses last year's run differentials (average runs scored minus average runs allowed) to try to estimate this year's top performers. \n\n\n#### Data\n\n  `schedule1 <- read_excel(\"schedule.xlsx\")`  - reads in a two column excel sheet with headers 'Home' and 'Away' and teams from each game listed below\n        \n  `battingstats <- read_excel(\"2022battingstats.xlsx\")` - reads in a excel sheet with 2022 MLB batting statistics for all teams \n        \n  `fieldingstats <- read_excel(\"fieldingstats2022.xlsx\")` - reads in a excel sheet with 2022 MLB fielding statistics for all teams\n\n2022 statistics are from [here](https://www.baseball-reference.com/leagues/majors/2022.shtml).\n\n\n#### Calculations\n\nThe [Bradley-Terry model](https://en.wikipedia.org/wiki/Bradley%E2%80%93Terry_model) is a probability model to predict outcomes of object i beating object j based on each objects ability or talent. In this instance, it is used to compare teams but it was originally to be used with players.\n\nTalent is calculated by z-scores of seasonal average run differential of each team and then divided by 10. It is then adjusted for home field advantage so 0.04, based on [this](https://sabr.org/journal/article/home-field-advantage/#:~:text=In%20every%20sport%20and%20at,percent%20of%20the%20games%20played.) article, is added to the probability of the home team winning.\n\nThe equation used in this project for probability is:\n\n    prob.Home = exp(Talent.Home) / (exp(Talent.Home) + exp(Talent.Visitor)) + 0.04)\n\nThen, that probability is plugged into another equation to calculate a winner from each game. \n\n    outcome = rbinom(nrow(.), 1, prob.Home), winner = ifelse(outcome, Home, Visitor))\n    \nThis equation uses [rbinom](https://www.programmingr.com/examples/neat-tricks/sample-r-function/r-rbinom/) which simulates a series of Bernoulli trials and returns the results. This returns a 1 if the home team wins and a 0 if the visiting team wins. \n\n\n\n::: {.cell}\n\n:::\n\n\n\n<!-- Also I am adding several helper functions `increasefont()` and `centertitle()` that I will use in ggplot2. -->\n\n<!-- ```{r} -->\n<!-- increasefont <- function(Size = 18){ -->\n<!--   theme(text = element_text(size = Size)) -->\n<!-- } -->\n\n<!-- centertitle <- function(Color = \"blue\"){ -->\n<!--     theme(plot.title =  -->\n<!--             element_text(colour = Color, size = 18,  -->\n<!--         hjust = 0.5, vjust = 0.8, angle = 0)) -->\n<!-- } -->\n<!-- ``` -->\n\n\n#### One simulation\n\nOne season simulation with Wins and Losses from each team using the Bradley Terry model to predict each game. \n\n\n::: {.cell}\n::: {.cell-output-display}\n|        NL East        | Wins|Losses |       NL Cent       | Wins|Losses |       NL West        | Wins|Losses |\n|:---------------------:|----:|:------|:-------------------:|----:|:------|:--------------------:|----:|:------|\n|     New York Mets     |   85|76     | St. Louis Cardinals |   91|70     | Los Angeles Dodgers  |   91|70     |\n|    Atlanta Braves     |   82|79     |  Milwaukee Brewers  |   81|80     | San Francisco Giants |   91|70     |\n| Philadelphia Phillies |   82|79     |   Cincinnati Reds   |   81|80     |   San Diego Padres   |   83|78     |\n| Washington Nationals  |   73|88     | Pittsburgh Pirates  |   80|81     | Arizona Diamondbacks |   81|80     |\n|     Miami Marlins     |   72|89     |    Chicago Cubs     |   74|87     |   Colorado Rockies   |   77|84     |\n:::\n\n::: {.cell-output-display}\n|      AL East      | Wins|Losses |       AL Cent       | Wins|Losses |      AL West       | Wins|Losses |\n|:-----------------:|----:|:------|:-------------------:|----:|:------|:------------------:|----:|:------|\n|  Boston Red Sox   |   84|78     |  Chicago White Sox  |   95|67     | Los Angeles Angels |   95|67     |\n| New York Yankees  |   83|79     |   Minnesota Twins   |   90|72     |   Texas Rangers    |   88|74     |\n|  Tampa Bay Rays   |   80|82     |   Detroit Tigers    |   80|82     |   Houston Astros   |   86|76     |\n| Toronto Blue Jays |   77|85     | Kansas City Royals  |   75|87     |  Seattle Mariners  |   70|92     |\n| Baltimore Orioles |   76|86     | Cleveland Guardians |   70|92     | Oakland Athletics  |   57|105    |\n:::\n:::\n\n\n\n#### 1000 Season Simulations\n\n\n::: {.cell}\n\n:::\n\n\nHere is the percentage of seasons in 1000 simulations where each team made the playoffs. \n\n\n::: {.cell}\n::: {.cell-output-display}\n|NL East               | Playoff % |NL Cent             | Playoff % |NL West              | Playoff % |\n|:---------------------|:---------:|:-------------------|:---------:|:--------------------|:---------:|\n|New York Mets         |   69.2%   |St. Louis Cardinals |   65.7%   |Los Angeles Dodgers  |   89.9%   |\n|Atlanta Braves        |   68.8%   |Milwaukee Brewers   |   47.4%   |San Diego Padres     |   45.5%   |\n|Philadelphia Phillies |   48.0%   |Chicago Cubs        |   28.8%   |San Francisco Giants |   44.2%   |\n|Miami Marlins         |   24.0%   |Cincinnati Reds     |   14.6%   |Arizona Diamondbacks |   28.3%   |\n|Washington Nationals  |   4.9%    |Pittsburgh Pirates  |   8.2%    |Colorado Rockies     |   12.5%   |\n:::\n\n::: {.cell-output-display}\n|AL East           | Playoff % |AL Cent             | Playoff % |AL West            | Playoff % |\n|:-----------------|:---------:|:-------------------|:---------:|:------------------|:---------:|\n|New York Yankees  |   78.8%   |Cleveland Guardians |   53.9%   |Houston Astros     |   77.8%   |\n|Toronto Blue Jays |   52.6%   |Minnesota Twins     |   43.3%   |Seattle Mariners   |   44.9%   |\n|Tampa Bay Rays    |   42.4%   |Chicago White Sox   |   36.7%   |Texas Rangers      |   32.7%   |\n|Baltimore Orioles |   33.3%   |Detroit Tigers      |   18.5%   |Los Angeles Angels |   30.7%   |\n|Boston Red Sox    |   27.5%   |Kansas City Royals  |   16.1%   |Oakland Athletics  |   10.8%   |\n:::\n:::\n\n\nHere is the percentage of wins each team had after 1000 seasons\n\n\n::: {.cell}\n::: {.cell-output-display}\n|NL East               | Win % |NL Cent             | Win % |NL West              | Win % |\n|:---------------------|:-----:|:-------------------|:-----:|:--------------------|:-----:|\n|Atlanta Braves        | 53.3% |St. Louis Cardinals | 52.6% |Los Angeles Dodgers  | 56.0% |\n|New York Mets         | 53.2% |Milwaukee Brewers   | 50.9% |San Diego Padres     | 50.9% |\n|Philadelphia Phillies | 51.0% |Chicago Cubs        | 48.9% |San Francisco Giants | 50.8% |\n|Miami Marlins         | 48.5% |Cincinnati Reds     | 47.0% |Arizona Diamondbacks | 49.2% |\n|Washington Nationals  | 45.1% |Pittsburgh Pirates  | 45.9% |Colorado Rockies     | 46.7% |\n:::\n\n::: {.cell-output-display}\n|AL East           | Win % |AL Cent             | Win % |AL West            | Win % |\n|:-----------------|:-----:|:-------------------|:-----:|:------------------|:-----:|\n|New York Yankees  | 54.2% |Cleveland Guardians | 51.4% |Houston Astros     | 54.1% |\n|Toronto Blue Jays | 51.6% |Minnesota Twins     | 50.4% |Seattle Mariners   | 50.5% |\n|Tampa Bay Rays    | 50.6% |Chicago White Sox   | 49.5% |Texas Rangers      | 49.4% |\n|Baltimore Orioles | 49.4% |Detroit Tigers      | 47.4% |Los Angeles Angels | 49.2% |\n|Boston Red Sox    | 48.7% |Kansas City Royals  | 47.1% |Oakland Athletics  | 46.3% |\n:::\n:::\n\n\n\n#### Comparing to the 2023 Season\n\nHere are the current standings and win percentages of each team in the MLB as of June 12th at 4 pm PST\n\n\n::: {.cell}\n::: {.cell-output-display}\n|NL East               |Win % |NL Cent             |Win % |NL West              |Win % |\n|:---------------------|:-----|:-------------------|:-----|:--------------------|:-----|\n|Atlanta Braves        |61.5% |Pittsburgh Pirates  |53.1% |Arizona Diamondbacks |61.5% |\n|Miami Marlins         |56.1% |Milwaukee Brewers   |51.5% |Los Angeles Dodgers  |56.1% |\n|Philadelphia Phillies |49.2% |Cincinnati Reds     |47%   |San Francisco Giants |50.8% |\n|New York Mets         |47%   |Chicago Cubs        |43.1% |San Diego Padres     |47.7% |\n|Washington Nationals  |40.6% |St. Louis Cardinals |40.9% |Colorado Rockies     |40.3% |\n:::\n\n::: {.cell-output-display}\n|AL East           |Win % |AL Cent             |Win % |AL West            |Win % |\n|:-----------------|:-----|:-------------------|:-----|:------------------|:-----|\n|Tampa Bay Rays    |70.6% |Minnesota Twins     |50%   |Texas Rangers      |64.1% |\n|Baltimore Orioles |63.1% |Cleveland Guardians |47.7% |Houston Astros     |56.1% |\n|New York Yankees  |56.7% |Chicago White Sox   |43.3% |Los Angeles Angels |53.7% |\n|Toronto Blue Jays |55.2% |Detroit Tigers      |41.3% |Seattle Mariners   |48.4% |\n|Boston Red Sox    |50%   |Kansas City Royals  |27.7% |Oakland Athletics  |25.4% |\n:::\n:::\n\n\n\n<!-- add percentage of wins of each team from simulation and also this year to have a better idea and rank them that way -->\n\nAs shown above, there are some similarities between the standings of last year and this year. \n\n\n<!-- Level is an ordinal response variable. Using a proportional odds model, model the ordinal response as a function of the team's talent. -->\n\n<!-- For a range of talent values from -0.9 to 0.9, find the fitted model probability of the three outcomes. -->\n\n<!-- ```{r} -->\n<!-- pfit <- polr(Level ~ Talent, -->\n<!--              data = all_out) -->\n<!-- DF <- data.frame(Talent = seq(-0.9, 0.9, -->\n<!--                                   length.out = 200)) -->\n<!-- Prob <- predict(pfit, DF, type = \"probs\") -->\n<!-- DF1 <- DF2 <- DF3 <- DF -->\n<!-- DF1$Probability <- Prob[, 3]; DF1$Type <- \"Division\" -->\n<!-- DF2$Probability <- Prob[, 2]; DF2$Type <- \"Wild Card\" -->\n<!-- DF3$Probability <- Prob[, 3] + Prob[, 2] -->\n<!-- DF3$Type <- \"Playoff\" -->\n<!-- DFall <- rbind(DF1, DF2, DF3) -->\n<!-- ``` -->\n\n<!-- Graph of this division, wild card, and playoff probabilities. -->\n\n<!-- ```{r} -->\n<!-- ggplot(DFall, aes(Talent, Probability, -->\n<!--                   color = Type)) + -->\n<!--   geom_line() + -->\n<!--   increasefont() + -->\n<!--   ggtitle(\"Probability of Reaching Different Levels\") + -->\n<!--   centertitle() -->\n<!-- ``` -->\n\n<!-- #### Talents of wild card teams and division-winners -->\n\n<!-- Construct density estimates of -->\n\n<!-- -   all teams -->\n<!-- -   teams that win division -->\n<!-- -   teams that get wild card -->\n\n<!-- ```{r} -->\n<!-- data1 <- filter(all_out, Wild.Card == 1) %>%  -->\n<!--          mutate(Type = \"Wild Card\") -->\n<!-- data2 <- filter(all_out, Winner.Div == 1) %>%  -->\n<!--   mutate(Type = \"Win Division\") -->\n<!-- data3 <- all_out %>%  -->\n<!--   mutate(Type = \"All Teams\") -->\n\n<!-- ggplot(rbind(data1, data2, data3),  -->\n<!--        aes(Talent, color = Type)) + -->\n<!--   geom_density(size = 1.5) + -->\n<!--   increasefont() + centertitle() + -->\n<!--   ggtitle(\"Talent Distributions for Three Types of Teams\") -->\n<!-- ``` -->\n\n<!-- #### How many games to win? -->\n\n<!-- Find the conditional probability of winning division title, of getting wild card, and making the playoffs given you won X games. -->\n\n<!-- ```{r} -->\n<!-- all_out %>%  -->\n<!--   filter(Wins >= 25, Wins <= 45) %>%  -->\n<!--   group_by(Wins) %>%  -->\n<!--   summarize(N = n(),  -->\n<!--             Prob_Div = mean(Winner.Div), -->\n<!--             Prob_WC = mean(Wild.Card), -->\n<!--             .groups = \"drop\") -> S -->\n<!-- ``` -->\n\n<!-- Plot smooths of these empirical probabilities. -->\n\n<!-- ```{r} -->\n<!-- S %>%  -->\n<!--   ggplot() + -->\n<!--   geom_smooth(aes(Wins, Prob_Div), se = FALSE, -->\n<!--               color = \"red\", -->\n<!--               method = \"loess\") + -->\n<!--   geom_smooth(aes(Wins, Prob_WC), se = FALSE, -->\n<!--               color = \"blue\", -->\n<!--               method = \"loess\") +  -->\n<!--   geom_smooth(aes(Wins, Prob_Div + Prob_WC), -->\n<!--                   se = FALSE, -->\n<!--               color = \"black\", -->\n<!--               method = \"loess\") + -->\n<!--   increasefont() + -->\n<!--   ylab(\"Probability\") + -->\n<!--   annotate(geom = \"text\", x = 32, y = 0.75, -->\n<!--            label = \"Playoffs\", size = 7) + -->\n<!--   annotate(geom = \"text\", x = 40.3, y = 0.75, -->\n<!--            label = \"Division\", size = 7, -->\n<!--            color = \"red\") + -->\n<!--   annotate(geom = \"text\", x = 40.8, y = 0.25, -->\n<!--            label = \"Wild Card\", size = 7, -->\n<!--            color = \"blue\") + -->\n<!--   ggtitle(\"How Many Games Does Team Need to Win?\") + -->\n<!--   centertitle() -->\n<!-- ``` -->\n\n<!-- \\`\\`\\`\\` -->\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}