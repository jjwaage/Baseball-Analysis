{
  "hash": "c0346214a562d89b72c6447da6c126fd",
  "result": {
    "markdown": "---\ntitle: \"Mariners Playoff Analysis\"\nauthor: \"Jonna Waage\"\ndate: \"2023-05-31\"\n---\n\n\n**If the rest of the MLB games this season were decided by a coin flip, would the Mariners make the playoffs?**\n\n\n\n\n\n#### Introduction\n\nSimulates a 2023 season of all 161 games using the Bradley-Terry model.\n\nBy repeated simulations, can explore the relationship between talent and season performance.\n\nTalent has been edited so that each team has the same talent. Essentially a 50/50 chance for each game.\n\n#### Main functions\n\nRead in two functions:\n\n-   `one.simulation.20()` performs the simulation\n-   `print_standings()` prints the division standings of the simulation\n\nReads in the data:\n\n-   `schedule1 <- read_excel(\"schedule.xlsx\")` reads in a two column excel sheet with headers 'Home' and 'Away' and teams from each game listed below\n\n\n::: {.cell}\n\n:::\n\n\nRead in several packages that I'll need.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(MASS)\n```\n:::\n\n\nAlso I am adding several helper functions `increasefont()` and `centertitle()` that I will use in ggplot2.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincreasefont <- function(Size = 18){\n  theme(text = element_text(size = Size))\n}\ncentertitle <- function(Color = \"blue\"){\n    theme(plot.title = \n            element_text(colour = Color, size = 18, \n        hjust = 0.5, vjust = 0.8, angle = 0))\n}\n```\n:::\n\n\n#### One simulation\n\nOne simulation assuming a standard deviation of 0.3.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# set.seed(121)\nout <- one.simulation.20(0.01)\nprint_standings(out)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                                                        \n                 AL East    W     L                   NL East    W     L\n                 ------------------                   ------------------\n           Tampa Bay Rays   93   68              Miami Marlins   91   70\n        Toronto Blue Jays   86   75              New York Mets   87   74\n        Baltimore Orioles   85   76             Atlanta Braves   86   75\n           Boston Red Sox   81   80      Philadelphia Phillies   76   85\n         New York Yankees   80   81       Washington Nationals   73   88\n                                                                        \n                 AL Cent    W     L                   NL Cent    W     L\n                 ------------------                   ------------------\n      Cleveland Guardians   97   64          Milwaukee Brewers   87   74\n        Chicago White Sox   79   82         Pittsburgh Pirates   83   78\n          Minnesota Twins   77   84               Chicago Cubs   78   83\n           Detroit Tigers   74   87            Cincinnati Reds   78   83\n       Kansas City Royals   73   88        St. Louis Cardinals   74   87\n                                                                        \n                 AL West    W     L                    NL West   W     L\n                 ------------------                   ------------------\n           Houston Astros   85   76           San Diego Padres   86   75\n         Seattle Mariners   78   83           Colorado Rockies   85   76\n            Texas Rangers   78   83       San Francisco Giants   84   77\n        Oakland Athletics   76   85       Arizona Diamondbacks   78   83\n       Los Angeles Angels   67   94        Los Angeles Dodgers   75   86\n```\n:::\n:::\n\n\n#### 1000 Simulations\n\nStore the results of 1000 simulated seasons:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_out <- NULL  \nfor(j in 1:1000){\n  out <- one.simulation.20(0.01)\n  out$Simulation <- j\n  all_out <- rbind(all_out, out)\n}\n```\n:::\n\n\n#### Talent and probability of making playoffs\n\n\n::: {.cell}\n\n:::\n\n\nDefine a new variable Level that is 0 (missed playoffs), 1 (wild-card), or 2 (win division).\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\nPrinting percentage of playoffs made from each team over 1000 seasons.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n                                                 \n                 AL East    Number     Percentage\n                               ------------------\n             New York Yankees      431      43.1%\n            Baltimore Orioles      405      40.5%\n            Toronto Blue Jays      392      39.2%\n               Tampa Bay Rays      386      38.6%\n               Boston Red Sox      384      38.4%\n                                                 \n                  AL Cent   Number     Percentage\n                               ------------------\n          Cleveland Guardians      422      42.2%\n            Chicago White Sox      411      41.1%\n           Kansas City Royals      381      38.1%\n              Minnesota Twins      378      37.8%\n               Detroit Tigers      363      36.3%\n                                                 \n                  AL West   Number     Percentage\n                               ------------------\n             Seattle Mariners      429      42.9%\n            Oakland Athletics      416      41.6%\n               Houston Astros      415      41.5%\n                Texas Rangers      399      39.9%\n           Los Angeles Angels      388      38.8%\n                                                   \n                   NL East    Number     Percentage\n                                 ------------------\n          Philadelphia Phillies      407      40.7%\n                  New York Mets      401      40.1%\n                  Miami Marlins      391      39.1%\n                 Atlanta Braves      390      39.0%\n           Washington Nationals      389      38.9%\n                                                   \n                  NL Cent     Number     Percentage\n                                 ------------------\n                Cincinnati Reds      416      41.6%\n            St. Louis Cardinals      412      41.2%\n              Milwaukee Brewers      403      40.3%\n             Pittsburgh Pirates      402      40.2%\n                   Chicago Cubs      396      39.6%\n                                                   \n                   NL West     Number    Percentage\n                                 ------------------\n           Arizona Diamondbacks      413      41.3%\n            Los Angeles Dodgers      402      40.2%\n           San Francisco Giants      394      39.4%\n               San Diego Padres      393      39.3%\n               Colorado Rockies      391      39.1%\n```\n:::\n:::\n\n\nLevel is an ordinal response variable. Using a proportional odds model, model the ordinal response as a function of the team's talent.\n\nFor a range of talent values from -0.9 to 0.9, find the fitted model probability of the three outcomes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npfit <- polr(Level ~ Talent,\n             data = all_out)\nDF <- data.frame(Talent = seq(-0.9, 0.9,\n                                  length.out = 200))\nProb <- predict(pfit, DF, type = \"probs\")\nDF1 <- DF2 <- DF3 <- DF\nDF1$Probability <- Prob[, 3]; DF1$Type <- \"Division\"\nDF2$Probability <- Prob[, 2]; DF2$Type <- \"Wild Card\"\nDF3$Probability <- Prob[, 3] + Prob[, 2]\nDF3$Type <- \"Playoff\"\nDFall <- rbind(DF1, DF2, DF3)\n```\n:::\n\n\nGraph of this division, wild card, and playoff probabilities.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(DFall, aes(Talent, Probability,\n                  color = Type)) +\n  geom_line() +\n  increasefont() +\n  ggtitle(\"Probability of Reaching Different Levels\") +\n  centertitle()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n#### Talents of wild card teams and division-winners\n\nConstruct density estimates of\n\n-   all teams\n-   teams that win division\n-   teams that get wild card\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata1 <- filter(all_out, Wild.Card == 1) %>% \n         mutate(Type = \"Wild Card\")\ndata2 <- filter(all_out, Winner.Div == 1) %>% \n  mutate(Type = \"Win Division\")\ndata3 <- all_out %>% \n  mutate(Type = \"All Teams\")\n\nggplot(rbind(data1, data2, data3), \n       aes(Talent, color = Type)) +\n  geom_density(size = 1.5) +\n  increasefont() + centertitle() +\n  ggtitle(\"Talent Distributions for Three Types of Teams\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n#### How many games to win?\n\nFind the conditional probability of winning division title, of getting wild card, and making the playoffs given you won X games.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_out %>% \n  filter(Wins >= 25, Wins <= 45) %>% \n  group_by(Wins) %>% \n  summarize(N = n(), \n            Prob_Div = mean(Winner.Div),\n            Prob_WC = mean(Wild.Card),\n            .groups = \"drop\") -> S\n```\n:::\n\n\nPlot smooths of these empirical probabilities.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nS %>% \n  ggplot() +\n  geom_smooth(aes(Wins, Prob_Div), se = FALSE,\n              color = \"red\",\n              method = \"loess\") +\n  geom_smooth(aes(Wins, Prob_WC), se = FALSE,\n              color = \"blue\",\n              method = \"loess\") + \n  geom_smooth(aes(Wins, Prob_Div + Prob_WC),\n                  se = FALSE,\n              color = \"black\",\n              method = \"loess\") +\n  increasefont() +\n  ylab(\"Probability\") +\n  annotate(geom = \"text\", x = 32, y = 0.75,\n           label = \"Playoffs\", size = 7) +\n  annotate(geom = \"text\", x = 40.3, y = 0.75,\n           label = \"Division\", size = 7,\n           color = \"red\") +\n  annotate(geom = \"text\", x = 40.8, y = 0.25,\n           label = \"Wild Card\", size = 7,\n           color = \"blue\") +\n  ggtitle(\"How Many Games Does Team Need to Win?\") +\n  centertitle()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\\`\\`\\`\\`\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}